%! Author = kyoto
%! Date = 08.03.2022


\section{Задание}
По выданному преподавателем варианту разработать и исследовать работу комплекса программ обмена данными в режиме
прерывания программы. Основная программа должна изменять содержимое заданной ячейки памяти (Х), которое должно быть
представлено как знаковое число. Область допустимых значений изменения Х должна быть ограничена заданной функцией F(X)
и конструктивными особенностями регистра данных ВУ (8-ми битное знаковое представление). Программа обработки прерывания
должна выводить на ВУ модифицированное значение Х в соответствии с вариантом задания, а также игнорировать все необрабатываемые прерывания.\\


\begin{figure}[H]
    \centering
    \includegraphics[scale=0.3]{img/variant}
\end{figure}


\section{Программа}

\subsection{Assembler}
\begin{center}
    \begin{tabular}{c}
        \begin{lstlisting}[basicstyle=\ttfamily\tiny]
        ORG     0x0
V0:     WORD    $DEF, 0x180
V1:     WORD    $INT1, 0x180
V2:     WORD    $INT2, 0x180
V3:     WORD    $DEF, 0x180
V4:     WORD    $DEF, 0x180
V5:     WORD    $DEF, 0x180
V6:     WORD    $DEF, 0x180
V7:     WORD    $DEF, 0x180
        ORG     0x2E
X:      WORD    0x0
LB:     WORD    0xFFD7
HB:     WORD    0x2C
DEF:    IRET
START:  DI
        CLA
        OUT     0x1
        OUT     0x7
        OUT     0xB
        OUT     0xF
        OUT     0x13
        OUT     0x17
        OUT     0x1B
        OUT     0x1F
        LD      #0x9
        OUT     0x3
        LD      #0xA
        OUT     0x5
        EI
MAIN:   DI
        LD      $X
        INC
        CALL    $CHECK
        ST      $X
        EI
        JUMP    $MAIN
CHECK:  CMP     $LB
        BPL     PART2
        JUMP    LOAD
PART2:  CMP     $HB
        BMI     RETN
        BEQ     RETN
LOAD:   LD      LB
RETN:   RET
INT2:   NOP
        IN      4
        AND     #0xF
        AND     $X
        CALL    $CHECK
        ST      $X
        NOP
        IRET
INT1:   ASL
        ADD     $X
        SUB     #0x5
        OUT     2
        NOP
        IRET
        \end{lstlisting}
    \end{tabular}
\end{center}

\newpage

\subsection{Описание программы:}
Программа циклически увеличивает значение ячейки памяти на 1 и обрабатывает прерывания. \\


\section{Область представления данных и область допустимых значений}

\subsection{Область представления:}
\noindent X, LB, HB - знаковое двухразрядное 16-ричное целое число. \\

\subsection{ОДЗ}

\subsubsection{F(x):}
\begin{equation*}
    \begin{center}
        $-128 \leqslant F(x) \leqslant 127$\\
    \end{center}
\end{equation*}

\subsection{X:}
\begin{equation*}
    \begin{center}
        \begin{cases}
            $ X \leqslant \frac{127+5}{3}$ , \\
            $  X \geqslant \frac{-128+5}{3} , $ \\
            $-41 \leqslant X \leqslant 44$ \\
        \end{cases}
    \end{center}
\end{equation*}


\section{Расположение программы в памяти БЭВМ:}
\noindent\textit{Вектор прерываний - \textbf{0x000 - 0x00F} . \\
Переменные – \textbf{0x02E-0x030} .  \\
Программа - \textbf{0x031-0x62}}


\section{Методика проверки.}
Проверка обработки прерываний:
\begin{enumerate}
    \item Загрузить текст программы в БЭВМ во вкладку Assembler.
    \item Заменить NOP в тексте программы на HLT.
    \item Запустить программу в режиме РАБОТА.
    \item Установить «Готовность ВУ-1».
    \item Дождаться остановки программы.
    \item Записать текущее значение X из памяти БЭВМ:
    \begin{enumerate}
        \item Запомнить текущее состояние счетчика команд.
        \item Ввести в клавишный регистр значение 0x02E
        \item Нажать «Ввод адреса».
        \item Нажать «Чтение».
        \item Записать значение регистра данных.
        \item Вернуть счетчик команд в исходное состояние.
    \end{enumerate}
    \item  Записать результат обработки прерывания – содержимое DR контроллера ВУ-1
    \item Рассчитать ожидаемое значение обработки прерывания по формуле $3*X-5$
    \item Сверить ожидаемые данные с полученными.
    \item Нажать «Продолжение».
    \item Ввести в ВУ-2 произвольный набор нулей и единиц 1010 0101    & 0xB (1011)   & 1 (0001)  & 1(0001)   & да.  \\
    , записать его
    \item Установить «Готовность ВУ-2».
    \item Дождаться остановки программы.
    \item Записать текущее значение X из памяти БЭВМ (аналогично п.6).
    \item Нажать «Продолжение».
    \item Записать текущее значение X из памяти БЭВМ (аналогично п.6).
    \item Рассчитать ожидаемое значение переменной X после обработки прерывания \\
    (Если X будет меньше минимального из ОДЗ, то запишется нижняя граница.)
    \item Проверить правильность маскирования полученного числа последними\\
    Четырьмя битами из введённого набора на ВУ.
\end{enumerate}
Проверка основной программы:
\begin{enumerate}
    \item Загрузить текст программы в БЭВМ.
    \item Записать в переменную X минимальное по ОДЗ значение (-41)
    \item Запустить программу в режиме попрограммного выполнения.
    \item Пройти нужное количество шагов программы, убедиться, что при увеличении X на 1, до того момента, когда он равен 45, происходит сброс значения в
    минимальное по ОДЗ (FFD7).
\end{enumerate}

Проверка обработки прерываний с ВУ-1:
\begin{center}
    \begin{tabular}{|c|c|c|c|}
        \hline
        X   & Предполагаемый результат & Полученный результат & Верно? \\
        \hline
        0x4 & $3*4-5=7$                & 0x7                  & да.    \\
        \hline
    \end{tabular}
\end{center}
Проверка обработки прерываний с ВУ-2:
\begin{center}
    \begin{tabular}{|c|c|c|c|c|}
        \hline
        Введённые данные с ВУ-2 & $X_{исх}$  & Предполагаемый результат & $X_{рез}$ & Верно? \\
        \hline
        1010 0101               & 0xB (1011) & 1 (0001)                 & 1(0001)   & да.    \\
        \hline
    \end{tabular}
\end{center}
Проверка работы основной программы (случай выхода из ОДЗ):
\begin{center}
    \begin{tabular}{|c|c|c|c|}
        \hline
        Значение икса перед & Какое значение должно  & Какой получился & Верно? \\
        выходом из ОДЗ      & было быть без проверки &                 &        \\
        \hline
        0x2C                & 0x2D                   & 0xFFD7          & да.    \\
        \hline
    \end{tabular}
\end{center}
